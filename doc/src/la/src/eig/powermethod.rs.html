<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The la library documentation.">

    <title>powermethod.rs.html -- source</title>

    <link href='http://fonts.googleapis.com/css?family=Source+Code+Pro:400,600'
          rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="../../../../main.css">

    
</head>
<body>
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

    <section class="sidebar">
        
        
    </section>

    <nav class="sub">
        <form class="search-form js-only">
            <div class="search-container">
                <input class="search-input" name="search"
                       autocomplete="off"
                       placeholder="Search documentation..."
                       type="search">
            </div>
        </form>
    </nav>

    <section id='main' class="content source"><pre class='line-numbers'><span id='1'>  1</span>
<span id='2'>  2</span>
<span id='3'>  3</span>
<span id='4'>  4</span>
<span id='5'>  5</span>
<span id='6'>  6</span>
<span id='7'>  7</span>
<span id='8'>  8</span>
<span id='9'>  9</span>
<span id='10'> 10</span>
<span id='11'> 11</span>
<span id='12'> 12</span>
<span id='13'> 13</span>
<span id='14'> 14</span>
<span id='15'> 15</span>
<span id='16'> 16</span>
<span id='17'> 17</span>
<span id='18'> 18</span>
<span id='19'> 19</span>
<span id='20'> 20</span>
<span id='21'> 21</span>
<span id='22'> 22</span>
<span id='23'> 23</span>
<span id='24'> 24</span>
<span id='25'> 25</span>
<span id='26'> 26</span>
<span id='27'> 27</span>
<span id='28'> 28</span>
<span id='29'> 29</span>
<span id='30'> 30</span>
<span id='31'> 31</span>
<span id='32'> 32</span>
<span id='33'> 33</span>
<span id='34'> 34</span>
<span id='35'> 35</span>
<span id='36'> 36</span>
<span id='37'> 37</span>
<span id='38'> 38</span>
<span id='39'> 39</span>
<span id='40'> 40</span>
<span id='41'> 41</span>
<span id='42'> 42</span>
<span id='43'> 43</span>
<span id='44'> 44</span>
<span id='45'> 45</span>
<span id='46'> 46</span>
<span id='47'> 47</span>
<span id='48'> 48</span>
<span id='49'> 49</span>
<span id='50'> 50</span>
<span id='51'> 51</span>
<span id='52'> 52</span>
<span id='53'> 53</span>
<span id='54'> 54</span>
<span id='55'> 55</span>
<span id='56'> 56</span>
<span id='57'> 57</span>
<span id='58'> 58</span>
<span id='59'> 59</span>
<span id='60'> 60</span>
<span id='61'> 61</span>
<span id='62'> 62</span>
<span id='63'> 63</span>
<span id='64'> 64</span>
<span id='65'> 65</span>
<span id='66'> 66</span>
<span id='67'> 67</span>
<span id='68'> 68</span>
<span id='69'> 69</span>
<span id='70'> 70</span>
<span id='71'> 71</span>
<span id='72'> 72</span>
<span id='73'> 73</span>
<span id='74'> 74</span>
<span id='75'> 75</span>
<span id='76'> 76</span>
<span id='77'> 77</span>
<span id='78'> 78</span>
<span id='79'> 79</span>
<span id='80'> 80</span>
<span id='81'> 81</span>
<span id='82'> 82</span>
<span id='83'> 83</span>
<span id='84'> 84</span>
<span id='85'> 85</span>
<span id='86'> 86</span>
<span id='87'> 87</span>
<span id='88'> 88</span>
<span id='89'> 89</span>
<span id='90'> 90</span>
<span id='91'> 91</span>
<span id='92'> 92</span>
<span id='93'> 93</span>
<span id='94'> 94</span>
<span id='95'> 95</span>
<span id='96'> 96</span>
<span id='97'> 97</span>
<span id='98'> 98</span>
<span id='99'> 99</span>
<span id='100'>100</span>
<span id='101'>101</span>
<span id='102'>102</span>
<span id='103'>103</span>
<span id='104'>104</span>
<span id='105'>105</span>
<span id='106'>106</span>
<span id='107'>107</span>
<span id='108'>108</span>
</pre><pre class='rust '>
<span class='kw'>use</span> <span class='ident'>std</span>::<span class='ident'>num</span>;
<span class='kw'>use</span> <span class='ident'>std</span>::<span class='ident'>num</span>::{<span class='ident'>Zero</span>, <span class='ident'>One</span>};

<span class='kw'>use</span> <span class='ident'>Matrix</span>;<span class='comment'>

// NOTE: This module contains untested alpha code

// Power method for calculating the dominant eigenvector
// Assuming linearly independent eigenvectors: v_1, v_2, ..., v_n
// Assuming eigenvalues: l_1, l_2, ..., l_n
// Let |l_1| &gt; |l_2| &gt; ... &gt; |l_n|
//
// For some vector q:
//   q = c_1 * v_1 + c_2 * v_2 + ... + c_n * v_3		(for some unknown constants c_1, c_2, ..., c_n)
// A * q = c_1 * A * v_1 + c_2 * A * v_2 + ... + c_n * A * v_n
//       = c_1 * l_1 * v_1 + c_2 * l_2 * v_2 + ... + c_n * l_n * v_n
// A^n * q = c_1 * l_1^n * v_1 + c_2 * l_2^n * v_2 + ... + c_n * l_n^n * v_n
//         = l_1^n * (c_1 * v_1 + c_2 * l_2^n / l_1^n * v_2 + ... + c_n * l_n^n / l_1^n * v_n)
//
// A^n * q / l_1^n = c_1 * v_1 + c_2 * l_2^n / l_1^n * v_2 + ... + c_n * l_n^n / l_1^n * v_n
// A^n * q / l_1^n - c_1 * v_1 = c_2 * l_2^n / l_1^n * v_2 + ... + c_n * l_n^n / l_1^n * v_n
//
// Norm of the error vector (from our iterative estimate to the real dominant eigenvector):
//   ||A^n * q / l_1^n - c_1 * v_1|| =  || c_2 * l_2^n / l_1^n * v_2 + ... + c_n * l_n^n / l_1^n * v_n ||
//                                   &lt;= |c_2| * |l^2/l^1|^n * ||v_2|| + ... + |c_n| * |l_n/l_1|^n * ||v_n||
//                                   &lt;= (|c_2| + ... + |c_n|) * |l^2/l^1|^n
// As n-&gt;inf, |l^2/l^1|^n -&gt; 0, thus our iterative estimate converges to the dominant eigenvector.
//
// To avoid overflow, we&#39;ll scale A^j * q with the largest absolute element of A^j * q in each step; again,
// we are only interested in the direction, not the scale.
//
// Inverse power method:
// Assuming linearly independent eigenvectors: v_1, v_2, ..., v_n
// Assuming eigenvalues: 1/l_1, 1/l_2, ..., 1/l_n
// Let |1/l_n| &gt; |1/l_{n-1}| &gt; ... &gt; |l_1|
//
// In Inverse power method, we iterate on A^-1 instead of A, which has the same eigenvectors, with inverse eigenvalues:
//   Av = lv
//   Assume: A^-1v = 1/l v
//           AA^-1v = A 1/l v
//           v = 1/l A v = 1/l lv = v.
//
// For some vector q:
//   q = c_n * v_n + ... + c_1 * v_1,		c_n != 0
// Then the inverse power method will converge to the eigenvector with the smallest eigenvalue of A (v_n).
//
// The convergence ratio is: |l_n/l_{n-1}|. If |l_{n-1}| &gt;&gt; |l_n||, the convergence will happen fast.
// Thus, if we shift l_n so that it will be very close to zero, the convergence will happen fast. We can shift
// the eigenvalue by using:
//   Av = lv
//   (A - rI)v = Av - rIv = Av - rv = lv - rv = (l - r)v
// Thus, the matrix (A - rI) has the same eigenvectors as A, with eigenvalues that are shifted down by r.
// Using shifting with inverse power method is called shift-and-invert strategy.
//
// Each step of the inverse and shift iteration is then essentially:
//   q_{j+1} = (A - rI)^-1 q_j / s_{j+1}			, where s_{j+1} is a scaling factor as described with direct power method.
// Note that instead of calculating the inverse: (A - rI)^-1, it&#39;s likely faster and more convenient to solve:
//   (A - rI) q&#39;_{j+1} = q_j
// And then set:
//   q_{j+1} = q&#39;_{j+1} / s_{j+1}.
//
// Shifting allows us to find any eigenvector, by shifting the specific eigenvalue to be the smallest. However, in
// order to do this, we need to have a good approximation of the associated eigenvalue to begin with.
//
// The shift-and-inverse stategy gives us a way to calculate an eigenvector, if we have an approximation of an eigenvalue.
// The Rayleigh quotient is a way to calculate an approximation of an eigenvalue, if we have an approximation of an eigenvector.
//
// Note: At each step of shift-and-inverse strategy, we could use a different value for the shift. This can be useful, if we
// don&#39;t have an estimate of the eigenvalue to start with to use as a shift: (Rayleigh quotient iteration).
//   - We&#39;ll start with a guess of the eigenvector.
//   - We&#39;ll use the Rayleigh quotient to approximate an eigenvalue for our guess-approximation of the eigenvector.
//   - We&#39;ll use the approximation of the eigenvalue to shift and come up with the next iteration of the eigenvector using shift-and-inverse.
//     (We might want to normalize the vector here, though not strictly necessary).
//   - We reiterate. This algorithm is not guaranteed to converge, but it seldom fails. And when it converges, it generally does so fast.
//
// The Rayleight quotient approximates the eigenvalue by calculating the least squares estimate for Aq = rq.
// Using normal equations we get:
//   r = q&#39;Aq / (q&#39;q).			// Note that if we normalized q, then we&#39;ll just have:  r = q&#39;Aq.
//
</span><span class='kw'>pub</span> <span class='kw'>fn</span> <span class='ident'>power_method</span>
    <span class='op'>&lt;</span><span class='ident'>T</span> : <span class='ident'>Mul</span><span class='op'>&lt;</span><span class='ident'>T</span>, <span class='ident'>T</span><span class='op'>&gt;</span> <span class='op'>+</span> <span class='ident'>Div</span><span class='op'>&lt;</span><span class='ident'>T</span>, <span class='ident'>T</span><span class='op'>&gt;</span> <span class='op'>+</span> <span class='ident'>Add</span><span class='op'>&lt;</span><span class='ident'>T</span>, <span class='ident'>T</span><span class='op'>&gt;</span> <span class='op'>+</span> <span class='ident'>Sub</span><span class='op'>&lt;</span><span class='ident'>T</span>, <span class='ident'>T</span><span class='op'>&gt;</span> <span class='op'>+</span> <span class='ident'>Zero</span> <span class='op'>+</span> <span class='ident'>One</span> <span class='op'>+</span> <span class='ident'>Ord</span> <span class='op'>+</span> <span class='ident'>Signed</span> <span class='op'>+</span> <span class='ident'>Clone</span> <span class='op'>+</span> <span class='ident'>Float</span><span class='op'>&gt;</span>
    (<span class='ident'>m</span> : <span class='kw-2'>&amp;</span><span class='ident'>Matrix</span><span class='op'>&lt;</span><span class='ident'>T</span><span class='op'>&gt;</span>, <span class='ident'>q</span> : <span class='kw-2'>&amp;</span><span class='ident'>Matrix</span><span class='op'>&lt;</span><span class='ident'>T</span><span class='op'>&gt;</span>, <span class='ident'>eps</span> : <span class='ident'>T</span>) <span class='op'>-&gt;</span> <span class='ident'>Matrix</span><span class='op'>&lt;</span><span class='ident'>T</span><span class='op'>&gt;</span> {
  <span class='macro'>assert</span><span class='macro'>!</span>(<span class='ident'>m</span>.<span class='ident'>cols</span>() <span class='op'>==</span> <span class='ident'>m</span>.<span class='ident'>rows</span>());
  <span class='macro'>assert</span><span class='macro'>!</span>(<span class='ident'>m</span>.<span class='ident'>cols</span>() <span class='op'>==</span> <span class='ident'>q</span>.<span class='ident'>rows</span>());
  <span class='macro'>assert</span><span class='macro'>!</span>(<span class='ident'>q</span>.<span class='ident'>cols</span>() <span class='op'>==</span> <span class='number'>1</span>);

  <span class='kw'>fn</span> <span class='ident'>max_elem</span><span class='op'>&lt;</span><span class='ident'>T</span> : <span class='ident'>Ord</span> <span class='op'>+</span> <span class='ident'>Signed</span> <span class='op'>+</span> <span class='ident'>Clone</span><span class='op'>&gt;</span>(<span class='ident'>v</span> : <span class='kw-2'>&amp;</span><span class='ident'>Matrix</span><span class='op'>&lt;</span><span class='ident'>T</span><span class='op'>&gt;</span>) <span class='op'>-&gt;</span> <span class='ident'>T</span> {
    <span class='kw'>let</span> <span class='kw-2'>mut</span> <span class='ident'>current_max</span> <span class='op'>=</span> <span class='ident'>num</span>::<span class='ident'>abs</span>(<span class='ident'>v</span>.<span class='ident'>get_data</span>().<span class='ident'>get</span>(<span class='number'>0</span>).<span class='ident'>clone</span>());
    <span class='kw'>for</span> _ <span class='kw'>in</span> <span class='ident'>range</span>(<span class='number'>1</span>, <span class='ident'>v</span>.<span class='ident'>rows</span>()) {
      <span class='kw'>let</span> <span class='ident'>v</span> <span class='op'>=</span> <span class='ident'>num</span>::<span class='ident'>abs</span>(<span class='ident'>v</span>.<span class='ident'>get_data</span>().<span class='ident'>get</span>(<span class='number'>1</span>).<span class='ident'>clone</span>());
      <span class='kw'>if</span> <span class='ident'>v</span> <span class='op'>&gt;</span> <span class='ident'>current_max</span> {
        <span class='ident'>current_max</span> <span class='op'>=</span> <span class='ident'>v</span>.<span class='ident'>clone</span>();
      }
    }
    <span class='ident'>current_max</span>
  }

  <span class='kw'>let</span> <span class='kw-2'>mut</span> <span class='ident'>v</span> <span class='op'>=</span> <span class='ident'>q</span>.<span class='ident'>scale</span>(<span class='ident'>num</span>::<span class='ident'>one</span>::<span class='op'>&lt;</span><span class='ident'>T</span><span class='op'>&gt;</span>() <span class='op'>/</span> <span class='ident'>max_elem</span>(<span class='ident'>q</span>));
  <span class='kw'>loop</span> {
    <span class='kw'>let</span> <span class='kw-2'>mut</span> <span class='ident'>nv</span> <span class='op'>=</span> <span class='ident'>m</span> <span class='op'>*</span> <span class='ident'>v</span>;
    <span class='kw'>let</span> <span class='ident'>factor</span> <span class='op'>=</span> <span class='ident'>num</span>::<span class='ident'>one</span>::<span class='op'>&lt;</span><span class='ident'>T</span><span class='op'>&gt;</span>() <span class='op'>/</span> <span class='ident'>max_elem</span>(<span class='kw-2'>&amp;</span><span class='ident'>nv</span>);
    <span class='ident'>nv</span>.<span class='ident'>mscale</span>(<span class='ident'>factor</span>);
    <span class='kw'>if</span> (<span class='ident'>nv</span> <span class='op'>-</span> <span class='ident'>v</span>).<span class='ident'>length</span>() <span class='op'>&lt;=</span> <span class='ident'>eps</span> {
      <span class='kw'>return</span> <span class='ident'>nv</span>;
    }
    <span class='ident'>v</span> <span class='op'>=</span> <span class='ident'>nv</span>;
  }
}
</pre>
</section>
    <section id='search' class="content hidden"></section>

    <section class="footer"></section>

    <div id="help" class="hidden">
        <div class="shortcuts">
            <h1>Keyboard shortcuts</h1>
            <dl>
                <dt>?</dt>
                <dd>Show this help dialog</dd>
                <dt>S</dt>
                <dd>Focus the search field</dd>
                <dt>&uarr;</dt>
                <dd>Move up in search results</dd>
                <dt>&darr;</dt>
                <dd>Move down in search results</dd>
                <dt>&#9166;</dt>
                <dd>Go to active search result</dd>
            </dl>
        </div>
        <div class="infos">
            <h1>Search tricks</h1>
            <p>
                Prefix searches with a type followed by a colon (e.g.
                <code>fn:</code>) to restrict the search to a given type.
            </p>
            <p>
                Accepted types are: <code>fn</code>, <code>mod</code>,
                <code>struct</code> (or <code>str</code>), <code>enum</code>,
                <code>trait</code>, <code>typedef</code> (or
                <code>tdef</code>).
            </p>
        </div>
    </div>

    <script>
        window.rootPath = "../../../../";
        window.currentCrate = "la";
        window.playgroundUrl = "";
    </script>
    <script src="../../../../jquery.js"></script>
    <script src="../../../../main.js"></script>
    
    <script async src="../../../../search-index.js"></script>
</body>
</html>